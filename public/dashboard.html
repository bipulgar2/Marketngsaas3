<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgencyOS | SEO Agency Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'Inter', 'sans-serif'],
                    },
                    colors: {
                        gray: {
                            900: '#111827',
                            950: '#0B0F19',
                        },
                        violet: {
                            500: '#8B5CF6',
                            600: '#7C3AED',
                        },
                    },
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap');

        html {
            font-size: 13px;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #0B0F19;
        }

        .top-tab {
            padding: 0.5rem 1rem;
            border-bottom: 2px solid transparent;
        }

        .top-tab.active {
            border-bottom-color: #8B5CF6;
            color: white;
        }

        .top-tab:hover {
            color: white;
        }

        .side-tab {
            padding: 0.5rem 0.75rem;
            border-left: 2px solid transparent;
        }

        .side-tab.active {
            border-left-color: #8B5CF6;
            background: rgba(139, 92, 246, 0.1);
            color: white;
        }

        .side-tab:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #0B0F19;
        }

        ::-webkit-scrollbar-thumb {
            background: #374151;
            border-radius: 3px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.15s ease-out forwards;
        }
    </style>
</head>

<body class="bg-gray-950 text-gray-100 h-screen flex flex-col overflow-hidden">

    <!-- Top Header Bar -->
    <header class="bg-gray-900 border-b border-gray-800 shrink-0">
        <div class="flex items-center justify-between px-4 h-12">
            <!-- Logo -->
            <div class="flex items-center gap-2">
                <div class="bg-gradient-to-r from-violet-600 to-indigo-600 p-1.5 rounded-lg">
                    <i data-lucide="brain-circuit" class="w-4 h-4 text-white"></i>
                </div>
                <span class="text-sm font-bold text-white">Agency<span class="text-violet-500">OS</span></span>
            </div>

            <!-- Top Tabs -->
            <nav class="flex items-center gap-1" id="topTabs">
                <!-- Populated by JS -->
            </nav>

            <!-- Right Side: Client Selector + New Client -->
            <div class="flex items-center gap-3">
                <select id="clientSelector" onchange="selectClient(this.value)"
                    class="bg-gray-800 border border-gray-700 text-white text-sm rounded-lg px-3 py-1.5 focus:border-violet-500 focus:outline-none min-w-[200px]">
                    <option value="">Select Client...</option>
                </select>
                <button onclick="showNewClientModal()"
                    class="bg-gradient-to-r from-violet-600 to-indigo-600 hover:from-violet-500 hover:to-indigo-500 text-white px-3 py-1.5 rounded-lg text-sm font-medium flex items-center gap-1.5">
                    <i data-lucide="plus" class="w-4 h-4"></i>
                    New Client
                </button>
            </div>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="flex-1 flex overflow-hidden">
        <!-- Left Sidebar (Side Tabs) -->
        <aside class="w-48 bg-gray-900 border-r border-gray-800 flex flex-col shrink-0">
            <div class="p-3 border-b border-gray-800">
                <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider" id="sidebarTitle">Navigation</p>
            </div>
            <nav class="flex-1 p-2 space-y-1 overflow-y-auto" id="sideTabs">
                <!-- Populated by JS -->
            </nav>

            <!-- User Info -->
            <div class="p-3 border-t border-gray-800">
                <div class="flex items-center gap-2 mb-2">
                    <div class="w-7 h-7 rounded-full bg-gradient-to-r from-violet-600 to-indigo-600 flex items-center justify-center text-white text-xs font-bold"
                        id="userAvatar">?</div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-white truncate" id="userName">Loading...</p>
                        <p class="text-xs text-gray-400 truncate" id="userRole">--</p>
                    </div>
                </div>
                <button onclick="logout()"
                    class="w-full flex items-center justify-center gap-1.5 px-2 py-1 text-xs text-gray-400 hover:text-white hover:bg-gray-800 rounded transition-colors">
                    <i data-lucide="log-out" class="w-3 h-3"></i> Logout
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 flex flex-col overflow-hidden">
            <!-- Content Header -->
            <div class="h-12 bg-gray-900/50 border-b border-gray-800 flex items-center justify-between px-6 shrink-0">
                <h1 class="text-base font-semibold text-white" id="pageTitle">Dashboard</h1>
                <div class="flex items-center gap-2" id="pageActions">
                    <!-- Actions populated by JS -->
                </div>
            </div>

            <!-- Content -->
            <div class="flex-1 overflow-y-auto p-6" id="contentArea">
                <div class="flex items-center justify-center h-full text-gray-500">
                    <i data-lucide="loader-2" class="w-5 h-5 animate-spin mr-2"></i> Loading...
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Container -->
    <div id="modalOverlay" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center z-50">
        <div id="modalContent"
            class="bg-gray-900 border border-gray-700 rounded-xl w-full max-w-lg shadow-2xl animate-fade-in">
        </div>
    </div>

    <script>
        // =========================================================================
        // STATE
        // =========================================================================
        let currentUser = null;
        let currentClient = null;
        let currentTopTab = 'dashboard';
        let currentSideTab = 'overview';
        let clients = [];

        // =========================================================================
        // TAB CONFIGURATION
        // =========================================================================
        const TOP_TABS = [
            { id: 'dashboard', label: 'Dashboard', icon: 'layout-dashboard' },
            { id: 'tech-audit', label: 'Tech Audit', icon: 'search-code' },
            { id: 'content', label: 'Content', icon: 'file-text' },
            { id: 'keywords', label: 'Keywords', icon: 'key' },
            { id: 'competitors', label: 'Competitors', icon: 'users' },
            { id: 'links', label: 'Links', icon: 'link' },
            { id: 'tasks', label: 'Tasks', icon: 'check-square' },
            { id: 'reports', label: 'Reports', icon: 'bar-chart-2' }
        ];

        const SIDE_TABS = {
            'dashboard': [
                { id: 'overview', label: 'Overview' },
                { id: 'clients', label: 'All Clients' },
                { id: 'team', label: 'Team' },
                { id: 'settings', label: 'Settings' }
            ],
            'tech-audit': [
                { id: 'url-inspection', label: 'URL Inspection' },
                { id: 'on-page', label: 'On-Page Report' },
                { id: 'technical-issues', label: 'Technical Issues' },
                { id: 'core-vitals', label: 'Core Web Vitals' },
                { id: 'schema', label: 'Schema Markup' },
                { id: 'page-speed', label: 'Page Speed' }
            ],
            'content': [
                { id: 'briefs', label: 'Briefs' },
                { id: 'drafts', label: 'Drafts' },
                { id: 'published', label: 'Published' },
                { id: 'calendar', label: 'Calendar' },
                { id: 'templates', label: 'Templates' }
            ],
            'keywords': [
                { id: 'research', label: 'Research' },
                { id: 'clusters', label: 'Topic Clusters' },
                { id: 'tracking', label: 'Rank Tracking' },
                { id: 'opportunities', label: 'Opportunities' },
                { id: 'intent-map', label: 'Intent Map' }
            ],
            'competitors': [
                { id: 'overview', label: 'Competitors' },
                { id: 'content-gap', label: 'Content Gap' },
                { id: 'backlink-gap', label: 'Backlink Gap' },
                { id: 'content-library', label: 'Their Content' },
                { id: 'strategy', label: 'Strategy' }
            ],
            'links': [
                { id: 'backlink-profile', label: 'Backlink Profile' },
                { id: 'inventory', label: 'Link Inventory' },
                { id: 'placements', label: 'Placements' },
                { id: 'anchor-planner', label: 'Anchor Planner' },
                { id: 'prospects', label: 'Prospects' }
            ],
            'tasks': [
                { id: 'all-tasks', label: 'All Tasks' },
                { id: 'by-type', label: 'By Type' },
                { id: 'by-assignee', label: 'By Assignee' },
                { id: 'kanban', label: 'Kanban Board' },
                { id: 'my-tasks', label: 'My Tasks' }
            ],
            'reports': [
                { id: 'generated', label: 'Generated Reports' },
                { id: 'create', label: 'Create Report' },
                { id: 'analytics', label: 'Analytics' },
                { id: 'wins', label: 'Wins' },
                { id: 'exports', label: 'Exports' }
            ]
        };

        // =========================================================================
        // INIT
        // =========================================================================
        async function init() {
            try {
                const response = await fetch('/api/auth/me');
                if (!response.ok) {
                    window.location.href = '/login.html';
                    return;
                }

                const data = await response.json();
                currentUser = data.user;

                // Update user info
                document.getElementById('userName').textContent = currentUser.full_name || currentUser.email.split('@')[0];
                document.getElementById('userRole').textContent = data.role_info?.name || currentUser.role;
                document.getElementById('userAvatar').textContent = (currentUser.full_name || currentUser.email)[0].toUpperCase();

                // Build UI
                buildTopTabs();
                buildSideTabs();
                await loadClients();
                loadContent();

                lucide.createIcons();
            } catch (error) {
                console.error('Init error:', error);
                window.location.href = '/login.html';
            }
        }

        // =========================================================================
        // BUILD UI
        // =========================================================================
        function buildTopTabs() {
            const container = document.getElementById('topTabs');
            container.innerHTML = TOP_TABS.map(tab => `
                <button onclick="switchTopTab('${tab.id}')" 
                    class="top-tab flex items-center gap-1.5 text-sm text-gray-400 transition-colors ${tab.id === currentTopTab ? 'active' : ''}">
                    <i data-lucide="${tab.icon}" class="w-4 h-4"></i>
                    ${tab.label}
                </button>
            `).join('');
            lucide.createIcons();
        }

        function buildSideTabs() {
            const container = document.getElementById('sideTabs');
            const tabs = SIDE_TABS[currentTopTab] || [];
            const titleMap = {
                'dashboard': 'Dashboard',
                'tech-audit': 'Tech Issues',
                'content': 'Content',
                'keywords': 'Keywords',
                'competitors': 'Competitors',
                'links': 'Links',
                'tasks': 'Tasks',
                'reports': 'Reports'
            };

            document.getElementById('sidebarTitle').textContent = titleMap[currentTopTab] || 'Navigation';

            container.innerHTML = tabs.map(tab => `
                <button onclick="switchSideTab('${tab.id}')" 
                    class="side-tab w-full text-left text-sm text-gray-400 rounded transition-colors ${tab.id === currentSideTab ? 'active' : ''}">
                    ${tab.label}
                </button>
            `).join('');
        }

        // =========================================================================
        // NAVIGATION
        // =========================================================================
        function switchTopTab(tabId) {
            currentTopTab = tabId;
            currentSideTab = SIDE_TABS[tabId]?.[0]?.id || 'overview';
            buildTopTabs();
            buildSideTabs();
            loadContent();
        }

        function switchSideTab(tabId) {
            currentSideTab = tabId;
            buildSideTabs();
            loadContent();
        }

        // =========================================================================
        // CLIENT SELECTOR
        // =========================================================================
        async function loadClients() {
            try {
                const response = await fetch('/api/campaigns');
                const data = await response.json();
                clients = data.campaigns || [];

                const selector = document.getElementById('clientSelector');
                selector.innerHTML = '<option value="">Select Client...</option>' +
                    clients.map(c => `<option value="${c.id}">${c.name} (${c.domain})</option>`).join('');

                // Restore selected client from URL
                const params = new URLSearchParams(window.location.search);
                const clientId = params.get('client');
                if (clientId) {
                    selector.value = clientId;
                    currentClient = clients.find(c => c.id === clientId);
                }
            } catch (error) {
                console.error('Error loading clients:', error);
            }
        }

        function selectClient(clientId) {
            currentClient = clients.find(c => c.id === clientId) || null;

            // Update URL
            const url = new URL(window.location);
            if (clientId) {
                url.searchParams.set('client', clientId);
            } else {
                url.searchParams.delete('client');
            }
            window.history.pushState({}, '', url);

            loadContent();
        }

        // =========================================================================
        // CONTENT LOADING
        // =========================================================================
        async function loadContent() {
            const contentArea = document.getElementById('contentArea');
            const pageTitle = document.getElementById('pageTitle');
            const pageActions = document.getElementById('pageActions');

            // Show loading
            contentArea.innerHTML = `<div class="flex items-center justify-center h-32 text-gray-500">
                <i data-lucide="loader-2" class="w-5 h-5 animate-spin mr-2"></i> Loading...
            </div>`;
            lucide.createIcons();

            // Set title
            const tab = TOP_TABS.find(t => t.id === currentTopTab);
            const sideTab = SIDE_TABS[currentTopTab]?.find(t => t.id === currentSideTab);
            pageTitle.textContent = sideTab?.label || tab?.label || 'Dashboard';

            // Load based on current tab
            if (currentTopTab === 'dashboard') {
                await loadDashboardContent();
            } else if (!currentClient) {
                contentArea.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-64 text-gray-500">
                        <i data-lucide="folder-open" class="w-12 h-12 mb-4 text-gray-600"></i>
                        <p class="text-lg font-medium">Select a client to view data</p>
                        <p class="text-sm mt-1">Use the dropdown in the top right corner</p>
                    </div>`;
                pageActions.innerHTML = '';
            } else {
                await loadTabContent();
            }

            lucide.createIcons();
        }

        async function loadDashboardContent() {
            const contentArea = document.getElementById('contentArea');
            const pageActions = document.getElementById('pageActions');

            if (currentSideTab === 'overview') {
                pageActions.innerHTML = '';

                try {
                    const [campaignsRes, tasksRes] = await Promise.all([
                        fetch('/api/campaigns'),
                        fetch('/api/tasks')
                    ]);
                    const campaigns = (await campaignsRes.json()).campaigns || [];
                    const tasks = (await tasksRes.json()).tasks || [];

                    const stats = {
                        clients: campaigns.length,
                        pending: tasks.filter(t => t.status === 'pending').length,
                        inProgress: tasks.filter(t => t.status === 'in_progress').length,
                        completed: tasks.filter(t => t.status === 'done').length
                    };

                    contentArea.innerHTML = `
                        <div class="grid grid-cols-4 gap-4 mb-6">
                            <div class="bg-gray-900 border border-gray-800 rounded-xl p-4">
                                <div class="flex items-center gap-3">
                                    <div class="p-2 bg-blue-500/20 rounded-lg">
                                        <i data-lucide="building" class="w-5 h-5 text-blue-400"></i>
                                    </div>
                                    <div>
                                        <p class="text-2xl font-bold text-white">${stats.clients}</p>
                                        <p class="text-xs text-gray-400">Active Clients</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gray-900 border border-gray-800 rounded-xl p-4">
                                <div class="flex items-center gap-3">
                                    <div class="p-2 bg-yellow-500/20 rounded-lg">
                                        <i data-lucide="clock" class="w-5 h-5 text-yellow-400"></i>
                                    </div>
                                    <div>
                                        <p class="text-2xl font-bold text-white">${stats.pending}</p>
                                        <p class="text-xs text-gray-400">Pending Tasks</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gray-900 border border-gray-800 rounded-xl p-4">
                                <div class="flex items-center gap-3">
                                    <div class="p-2 bg-violet-500/20 rounded-lg">
                                        <i data-lucide="loader-2" class="w-5 h-5 text-violet-400"></i>
                                    </div>
                                    <div>
                                        <p class="text-2xl font-bold text-white">${stats.inProgress}</p>
                                        <p class="text-xs text-gray-400">In Progress</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gray-900 border border-gray-800 rounded-xl p-4">
                                <div class="flex items-center gap-3">
                                    <div class="p-2 bg-emerald-500/20 rounded-lg">
                                        <i data-lucide="check-circle" class="w-5 h-5 text-emerald-400"></i>
                                    </div>
                                    <div>
                                        <p class="text-2xl font-bold text-white">${stats.completed}</p>
                                        <p class="text-xs text-gray-400">Completed</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-900 border border-gray-800 rounded-xl">
                            <div class="px-4 py-3 border-b border-gray-800 flex items-center justify-between">
                                <h3 class="text-sm font-semibold text-white">Recent Tasks</h3>
                                <button onclick="switchTopTab('tasks')" class="text-xs text-violet-400 hover:text-violet-300">View all →</button>
                            </div>
                            <div class="divide-y divide-gray-800">
                                ${tasks.length ? tasks.slice(0, 5).map(t => `
                                    <div class="px-4 py-3 flex items-center justify-between hover:bg-gray-800/30">
                                        <div class="flex items-center gap-3">
                                            <span class="w-2 h-2 rounded-full ${getStatusColor(t.status)}"></span>
                                            <span class="text-sm text-white">${t.title}</span>
                                        </div>
                                        <span class="text-xs px-2 py-1 rounded bg-gray-800 text-gray-400">${t.type}</span>
                                    </div>
                                `).join('') : '<p class="px-4 py-8 text-center text-gray-500">No tasks yet</p>'}
                            </div>
                        </div>
                    `;
                } catch (error) {
                    contentArea.innerHTML = `<div class="text-red-400">Error: ${error.message}</div>`;
                }
            } else if (currentSideTab === 'clients') {
                pageActions.innerHTML = `
                    <button onclick="showNewClientModal()" class="bg-violet-600 hover:bg-violet-500 text-white px-3 py-1.5 rounded-lg text-sm font-medium flex items-center gap-1.5">
                        <i data-lucide="plus" class="w-4 h-4"></i> New Client
                    </button>`;

                try {
                    const response = await fetch('/api/campaigns');
                    const { campaigns } = await response.json();

                    if (!campaigns?.length) {
                        contentArea.innerHTML = `
                            <div class="flex flex-col items-center justify-center h-64 text-center">
                                <i data-lucide="folder-plus" class="w-12 h-12 text-gray-600 mb-4"></i>
                                <h3 class="text-lg font-semibold text-white mb-2">No clients yet</h3>
                                <p class="text-gray-400 mb-4">Add your first client to get started</p>
                                <button onclick="showNewClientModal()" class="bg-violet-600 hover:bg-violet-500 text-white px-4 py-2 rounded-lg text-sm font-medium">
                                    + Add Client
                                </button>
                            </div>`;
                    } else {
                        contentArea.innerHTML = `
                            <div class="bg-gray-900 border border-gray-800 rounded-xl overflow-hidden">
                                <table class="w-full">
                                    <thead class="bg-gray-900/50 text-xs uppercase text-gray-400 border-b border-gray-800">
                                        <tr>
                                            <th class="px-4 py-3 text-left font-medium">Client</th>
                                            <th class="px-4 py-3 text-left font-medium">Domain</th>
                                            <th class="px-4 py-3 text-left font-medium">Status</th>
                                            <th class="px-4 py-3 text-left font-medium">Created</th>
                                            <th class="px-4 py-3 text-right font-medium">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-800 text-sm">
                                        ${campaigns.map(c => `
                                            <tr class="hover:bg-gray-800/30 cursor-pointer" onclick="selectClient('${c.id}'); switchTopTab('tech-audit');">
                                                <td class="px-4 py-3 font-medium text-white">${c.name}</td>
                                                <td class="px-4 py-3 text-gray-400">${c.domain}</td>
                                                <td class="px-4 py-3">
                                                    <span class="px-2 py-1 text-xs rounded ${c.status === 'active' ? 'bg-emerald-500/20 text-emerald-400' : 'bg-gray-700 text-gray-400'}">${c.status}</span>
                                                </td>
                                                <td class="px-4 py-3 text-gray-500">${new Date(c.created_at).toLocaleDateString()}</td>
                                                <td class="px-4 py-3 text-right">
                                                    <button class="text-gray-400 hover:text-white">
                                                        <i data-lucide="chevron-right" class="w-4 h-4"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>`;
                    }
                } catch (error) {
                    contentArea.innerHTML = `<div class="text-red-400">Error: ${error.message}</div>`;
                }
            } else if (currentSideTab === 'team') {
                pageActions.innerHTML = `
                    <button onclick="showInviteModal()" class="bg-violet-600 hover:bg-violet-500 text-white px-3 py-1.5 rounded-lg text-sm font-medium flex items-center gap-1.5">
                        <i data-lucide="user-plus" class="w-4 h-4"></i> Invite Member
                    </button>`;
                contentArea.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-64 text-center text-gray-500">
                        <i data-lucide="users" class="w-12 h-12 text-gray-600 mb-4"></i>
                        <p>Team management coming soon</p>
                    </div>`;
            } else if (currentSideTab === 'settings') {
                pageActions.innerHTML = '';
                contentArea.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-64 text-center text-gray-500">
                        <i data-lucide="settings" class="w-12 h-12 text-gray-600 mb-4"></i>
                        <p>Settings page coming soon</p>
                    </div>`;
            }

            lucide.createIcons();
        }

        async function loadTabContent() {
            const contentArea = document.getElementById('contentArea');
            const pageActions = document.getElementById('pageActions');

            // Placeholder for client-specific tabs
            pageActions.innerHTML = '';

            if (currentTopTab === 'tech-audit') {
                pageActions.innerHTML = `
                    <button onclick="runAudit()" class="bg-violet-600 hover:bg-violet-500 text-white px-3 py-1.5 rounded-lg text-sm font-medium flex items-center gap-1.5">
                        <i data-lucide="play" class="w-4 h-4"></i> Run Audit
                    </button>`;
            }

            contentArea.innerHTML = `
                <div class="bg-gray-900 border border-gray-800 rounded-xl p-8 text-center">
                    <i data-lucide="construction" class="w-12 h-12 text-gray-600 mx-auto mb-4"></i>
                    <h3 class="text-lg font-semibold text-white mb-2">${currentClient?.name || 'Client'} — ${currentSideTab.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</h3>
                    <p class="text-gray-400">This section will show ${currentSideTab} data for ${currentClient?.domain || 'selected client'}.</p>
                    <p class="text-xs text-gray-500 mt-4">Implementation coming in Phase 2</p>
                </div>`;

            lucide.createIcons();
        }

        // =========================================================================
        // HELPERS
        // =========================================================================
        function getStatusColor(status) {
            const colors = { pending: 'bg-yellow-400', in_progress: 'bg-blue-400', review: 'bg-violet-400', done: 'bg-emerald-400' };
            return colors[status] || 'bg-gray-400';
        }

        // =========================================================================
        // MODALS
        // =========================================================================
        function showModal(content) {
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('modalOverlay').classList.remove('hidden');
            document.getElementById('modalOverlay').classList.add('flex');
            lucide.createIcons();
        }

        function hideModal() {
            document.getElementById('modalOverlay').classList.add('hidden');
            document.getElementById('modalOverlay').classList.remove('flex');
        }

        function showNewClientModal() {
            showModal(`
                <div class="p-4 border-b border-gray-800 flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-white">New Client</h3>
                    <button onclick="hideModal()" class="text-gray-400 hover:text-white">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                <form onsubmit="createClient(event)" class="p-4 space-y-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Domain</label>
                        <input type="text" name="domain" required placeholder="example.com" 
                            class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:border-violet-500 focus:outline-none">
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Language</label>
                            <select name="language" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:border-violet-500 focus:outline-none">
                                <option value="English">English</option>
                                <option value="Spanish">Spanish</option>
                                <option value="French">French</option>
                                <option value="German">German</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Location</label>
                            <select name="location" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:border-violet-500 focus:outline-none">
                                <option value="US">United States</option>
                                <option value="UK">United Kingdom</option>
                                <option value="IN">India</option>
                                <option value="AU">Australia</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Focus</label>
                        <select name="focus" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:border-violet-500 focus:outline-none">
                            <option value="Product">Product (E-commerce)</option>
                            <option value="Service">Service</option>
                            <option value="Local">Local Business</option>
                            <option value="SaaS">SaaS</option>
                        </select>
                    </div>
                    <div class="flex gap-3 pt-2">
                        <button type="button" onclick="hideModal()" class="flex-1 bg-gray-800 text-gray-300 px-4 py-2 rounded-lg text-sm hover:bg-gray-700">Cancel</button>
                        <button type="submit" class="flex-1 bg-violet-600 hover:bg-violet-500 text-white px-4 py-2 rounded-lg text-sm font-medium">Create</button>
                    </div>
                </form>
            `);
        }

        async function createClient(e) {
            e.preventDefault();
            const form = e.target;
            const data = {
                name: form.domain.value,
                domain: form.domain.value,
                settings: {
                    language: form.language.value,
                    location: form.location.value,
                    focus: form.focus.value
                }
            };

            try {
                const res = await fetch('/api/campaigns', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (res.ok) {
                    hideModal();
                    await loadClients();
                    loadContent();
                } else {
                    const err = await res.json();
                    alert(err.error || 'Failed to create client');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function runAudit() {
            if (!currentClient) {
                alert('Please select a client first');
                return;
            }

            try {
                const res = await fetch('/api/audits', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        campaign_id: currentClient.id,
                        type: 'technical'
                    })
                });

                if (res.ok) {
                    showModal(`
                        <div class="p-6 text-center">
                            <div class="w-12 h-12 mx-auto mb-4 bg-violet-500/20 rounded-full flex items-center justify-center">
                                <i data-lucide="loader-2" class="w-6 h-6 text-violet-400 animate-spin"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-white mb-2">Audit Started</h3>
                            <p class="text-gray-400 text-sm mb-4">Running technical audit for ${currentClient.domain}...</p>
                            <button onclick="hideModal()" class="bg-violet-600 hover:bg-violet-500 text-white px-4 py-2 rounded-lg text-sm font-medium">OK</button>
                        </div>
                    `);
                    lucide.createIcons();
                } else {
                    const err = await res.json();
                    alert(err.error || 'Failed to start audit');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function showInviteModal() {
            showModal(`
                <div class="p-4 border-b border-gray-800">
                    <h3 class="text-lg font-semibold text-white">Invite Team Member</h3>
                </div>
                <div class="p-4 text-center text-gray-400">
                    <p>Team invites coming soon</p>
                </div>
            `);
        }

        // =========================================================================
        // AUTH
        // =========================================================================
        async function logout() {
            try {
                await fetch('/api/auth/logout', { method: 'POST' });
                window.location.href = '/login.html';
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        // Click outside modal to close
        document.getElementById('modalOverlay').addEventListener('click', (e) => {
            if (e.target.id === 'modalOverlay') hideModal();
        });

        // Start
        init();
    </script>
</body>

</html>